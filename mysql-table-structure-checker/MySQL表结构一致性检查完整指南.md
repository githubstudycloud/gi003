# MySQL 5.7 è¡¨ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥ä¸ä¿®å¤å®Œæ•´æŒ‡å—

> ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025å¹´11æœˆ26æ—¥
>
> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨æœ¬å·¥å…·æ£€æŸ¥MySQL 5.7ä¸­ä»¥ä»»æ„å‰ç¼€å¼€å¤´çš„è¡¨ç»“æ„ä¸€è‡´æ€§ï¼Œå¹¶ç”Ÿæˆä¿®å¤SQLè¯­å¥ã€‚

## ğŸ“‹ ç›®å½•

- [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
- [å·¥å…·æ¦‚è¿°](#å·¥å…·æ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®Œæ•´ä½¿ç”¨æµç¨‹](#å®Œæ•´ä½¿ç”¨æµç¨‹)
- [SQLè¯­å¥è¯¦è§£](#sqlè¯­å¥è¯¦è§£)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## é—®é¢˜èƒŒæ™¯

åœ¨MySQLæ•°æ®åº“ä¸­ï¼Œå½“ä½¿ç”¨åˆ†è¡¨ç­–ç•¥æ—¶ï¼ˆå¦‚ `aa_001`, `aa_002`, `aa_003`ï¼‰ï¼Œæ‰€æœ‰åˆ†è¡¨åº”è¯¥å…·æœ‰å®Œå…¨ä¸€è‡´çš„è¡¨ç»“æ„ã€‚ä½†åœ¨å®é™…è¿ç»´ä¸­ï¼Œå¯èƒ½å› ä¸ºä»¥ä¸‹åŸå› å¯¼è‡´è¡¨ç»“æ„ä¸ä¸€è‡´ï¼š

1. æ‰‹åŠ¨æ‰§è¡ŒDDLæ—¶é—æ¼äº†éƒ¨åˆ†è¡¨
2. æ•°æ®åº“è¿ç§»è„šæœ¬æ‰§è¡Œä¸å®Œæ•´
3. å¤šäººåä½œæ—¶çš„ç‰ˆæœ¬å†²çª
4. å†å²é—ç•™é—®é¢˜

**æœ¬å·¥å…·çš„æ ¸å¿ƒåŠŸèƒ½**ï¼šä»¥ä¸€ä¸ª"æ ‡å‡†è¡¨"ï¼ˆå­—æ®µå®Œæ•´çš„è¡¨ï¼‰ä½œä¸ºå‚è€ƒï¼Œæ£€æŸ¥æ‰€æœ‰åŒå‰ç¼€çš„è¡¨ï¼Œæ‰¾å‡ºç¼ºå¤±çš„å­—æ®µï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆä¿®å¤SQLã€‚

---

## å·¥å…·æ¦‚è¿°

### æ–‡ä»¶æ¸…å•

| æ–‡ä»¶å | ç‰ˆæœ¬ | æè¿° |
|--------|------|------|
| `check_table_structure.sql` | v1.0 | åŸºç¡€ç‰ˆæœ¬ï¼Œ5æ­¥æ£€æŸ¥æµç¨‹ |
| `check_table_structure_v2.sql` | v2.0 | **æ¨èç‰ˆæœ¬**ï¼Œ7æ­¥å®Œæ•´æµç¨‹ |
| `README.md` | - | åŸºç¡€è¯´æ˜æ–‡æ¡£ |
| `README_v2.md` | - | v2.0è¯¦ç»†æ–‡æ¡£ |
| `MySQLè¡¨ç»“æ„æ£€æŸ¥å·¥å…·ä½¿ç”¨æŒ‡å—.md` | - | è¯¦ç»†ä½¿ç”¨æ•™ç¨‹ |
| `MySQLè¡¨ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥å®Œæ•´æŒ‡å—.md` | - | æœ¬æ–‡æ¡£ |

### åŠŸèƒ½ç‰¹æ€§

- âœ… æ”¯æŒä»»æ„å‰ç¼€ï¼ˆaaã€bbã€userã€order ç­‰ï¼‰
- âœ… å±•ç¤ºæ ‡å‡†è¡¨å®Œæ•´å­—æ®µç»“æ„
- âœ… ç»Ÿè®¡æ¯ä¸ªè¡¨ç¼ºå¤±å­—æ®µæ•°é‡
- âœ… æ˜¾ç¤ºç¼ºå¤±å­—æ®µè¯¦ç»†ä¿¡æ¯
- âœ… ç”ŸæˆåŸºç¡€ç‰ˆ ALTER TABLE è¯­å¥
- âœ… ç”Ÿæˆå¸¦ AFTER çš„ç²¾ç¡®ä½ç½®ä¿®å¤è¯­å¥
- âœ… æ±‡æ€»æŠ¥å‘Š

---

## å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šé…ç½®å‚æ•°

æ‰“å¼€ `check_table_structure_v2.sql`ï¼Œä¿®æ”¹å¤´éƒ¨çš„3ä¸ªé…ç½®å˜é‡ï¼š

```sql
SET @db_name = 'your_database_name';  -- æ•°æ®åº“åï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
SET @table_prefix = 'aa';              -- è¡¨å‰ç¼€ï¼ˆå¦‚ aaã€orderã€userï¼‰
SET @standard_table = 'aa_example';    -- æ ‡å‡†è¡¨åï¼ˆå­—æ®µå®Œæ•´çš„å‚è€ƒè¡¨ï¼‰
```

### æ­¥éª¤2ï¼šæ‰§è¡ŒSQL

åœ¨MySQLå®¢æˆ·ç«¯æˆ–å·¥å…·ï¼ˆå¦‚Navicatã€DBeaverï¼‰ä¸­æ‰§è¡Œæ•´ä¸ªSQLæ–‡ä»¶ã€‚

### æ­¥éª¤3ï¼šæŸ¥çœ‹ç»“æœ

å·¥å…·ä¼šä¾æ¬¡è¾“å‡ºï¼š
1. æ‰€æœ‰åŒ¹é…å‰ç¼€çš„è¡¨åˆ—è¡¨
2. æ ‡å‡†è¡¨çš„å­—æ®µç»“æ„
3. ç¼ºå¤±å­—æ®µç»Ÿè®¡
4. ç¼ºå¤±å­—æ®µè¯¦æƒ…
5. åŸºç¡€ç‰ˆä¿®å¤SQL
6. æ¨èç‰ˆä¿®å¤SQLï¼ˆä¿æŒå­—æ®µé¡ºåºï¼‰
7. æ±‡æ€»æŠ¥å‘Š

### æ­¥éª¤4ï¼šæ‰§è¡Œä¿®å¤

å¤åˆ¶æ­¥éª¤5æˆ–æ­¥éª¤6ç”Ÿæˆçš„ALTER TABLEè¯­å¥ï¼Œåœ¨ç›®æ ‡æ•°æ®åº“æ‰§è¡Œã€‚

---

## å®Œæ•´ä½¿ç”¨æµç¨‹

### åœºæ™¯ç¤ºä¾‹

å‡è®¾æœ‰ä»¥ä¸‹æ•°æ®åº“ç»“æ„ï¼š
- æ•°æ®åº“åï¼š`my_app_db`
- è¡¨å‰ç¼€ï¼š`aa`
- æ ‡å‡†è¡¨ï¼š`aa_example`ï¼ˆåŒ…å«å®Œæ•´çš„10ä¸ªå­—æ®µï¼‰
- åˆ†è¡¨ï¼š`aa_001`, `aa_002`, `aa_003`ï¼ˆéƒ¨åˆ†è¡¨ç¼ºå°‘å­—æ®µï¼‰

### ç¬¬ä¸€æ­¥ï¼šé…ç½®å‚æ•°

```sql
SET @db_name = 'my_app_db';
SET @table_prefix = 'aa';
SET @standard_table = 'aa_example';
```

### ç¬¬äºŒæ­¥ï¼šæŸ¥è¯¢æ‰€æœ‰åŒ¹é…çš„è¡¨

æ‰§è¡Œåä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

| è¡¨å | å­˜å‚¨å¼•æ“ | ä¼°è®¡è¡Œæ•° | æ•°æ®å¤§å°(MB) | åˆ›å»ºæ—¶é—´ |
|------|----------|----------|--------------|----------|
| aa_example | InnoDB | 1000 | 0.25 | 2024-01-01 |
| aa_001 | InnoDB | 500 | 0.12 | 2024-01-02 |
| aa_002 | InnoDB | 300 | 0.08 | 2024-01-03 |
| aa_003 | InnoDB | 200 | 0.05 | 2024-01-04 |

### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹æ ‡å‡†è¡¨ç»“æ„

è¾“å‡ºæ ‡å‡†è¡¨çš„å®Œæ•´å­—æ®µä¿¡æ¯ï¼š

| å­—æ®µåºå· | å­—æ®µå | å­—æ®µç±»å‹ | æ˜¯å¦å¯ç©º | é»˜è®¤å€¼ | é¢å¤–å±æ€§ | å­—æ®µæ³¨é‡Š |
|----------|--------|----------|----------|--------|----------|----------|
| 1 | id | int(11) | NO | (æ— é»˜è®¤å€¼) | auto_increment | ä¸»é”®ID |
| 2 | name | varchar(100) | NO | (æ— é»˜è®¤å€¼) | | ç”¨æˆ·å |
| 3 | email | varchar(100) | YES | NULL | | é‚®ç®±åœ°å€ |
| 4 | status | tinyint(4) | NO | 1 | | çŠ¶æ€ |
| 5 | created_at | datetime | NO | CURRENT_TIMESTAMP | | åˆ›å»ºæ—¶é—´ |

### ç¬¬å››æ­¥ï¼šæŸ¥çœ‹ç¼ºå¤±å­—æ®µç»Ÿè®¡

| è¡¨å | æ ‡å‡†è¡¨å­—æ®µæ•° | å½“å‰è¡¨å­—æ®µæ•° | ç¼ºå°‘å­—æ®µæ•° | çŠ¶æ€ |
|------|--------------|--------------|------------|------|
| aa_002 | 5 | 3 | 2 | âœ— ä¸¥é‡ç¼ºå¤± |
| aa_003 | 5 | 4 | 1 | âš  å°‘é‡ç¼ºå¤± |

### ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹ç¼ºå¤±å­—æ®µè¯¦æƒ…

| è¡¨å | å­—æ®µåºå· | ç¼ºå°‘çš„å­—æ®µ | å­—æ®µç±»å‹ | æ˜¯å¦å¯ç©º | é»˜è®¤å€¼ | å­—æ®µæ³¨é‡Š |
|------|----------|------------|----------|----------|--------|----------|
| aa_002 | 3 | email | varchar(100) | YES | NULL | é‚®ç®±åœ°å€ |
| aa_002 | 5 | created_at | datetime | NO | (æ— ) | åˆ›å»ºæ—¶é—´ |
| aa_003 | 3 | email | varchar(100) | YES | NULL | é‚®ç®±åœ°å€ |

### ç¬¬å…­æ­¥ï¼šç”Ÿæˆä¿®å¤SQL

**åŸºç¡€ç‰ˆï¼ˆå­—æ®µæ·»åŠ åˆ°è¡¨æœ«å°¾ï¼‰ï¼š**

```sql
ALTER TABLE `aa_002` ADD COLUMN `email` varchar(100) NULL DEFAULT NULL COMMENT 'é‚®ç®±åœ°å€';
ALTER TABLE `aa_002` ADD COLUMN `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´';
ALTER TABLE `aa_003` ADD COLUMN `email` varchar(100) NULL DEFAULT NULL COMMENT 'é‚®ç®±åœ°å€';
```

**æ¨èç‰ˆï¼ˆä¿æŒå­—æ®µé¡ºåºï¼‰ï¼š**

```sql
ALTER TABLE `aa_002` ADD COLUMN `email` varchar(100) NULL DEFAULT NULL COMMENT 'é‚®ç®±åœ°å€' AFTER `name`;
ALTER TABLE `aa_002` ADD COLUMN `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´' AFTER `status`;
ALTER TABLE `aa_003` ADD COLUMN `email` varchar(100) NULL DEFAULT NULL COMMENT 'é‚®ç®±åœ°å€' AFTER `name`;
```

### ç¬¬ä¸ƒæ­¥ï¼šæ±‡æ€»æŠ¥å‘Š

| ç»Ÿè®¡é¡¹ | éœ€è¦ä¿®å¤çš„è¡¨æ•° | éœ€è¦æ·»åŠ çš„å­—æ®µæ•° |
|--------|----------------|------------------|
| æ€»è®¡ | 2 | 3 |

---

## SQLè¯­å¥è¯¦è§£

### æ ¸å¿ƒæŸ¥è¯¢åŸç†

å·¥å…·ä½¿ç”¨ `information_schema` ç³»ç»Ÿåº“æ¥è·å–è¡¨ç»“æ„ä¿¡æ¯ï¼š

```sql
-- è·å–è¡¨ä¿¡æ¯
SELECT * FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_db' AND TABLE_NAME LIKE 'aa%';

-- è·å–å­—æ®µä¿¡æ¯
SELECT * FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = 'your_db' AND TABLE_NAME = 'aa_example';
```

### ç¼ºå¤±å­—æ®µæ£€æµ‹é€»è¾‘

```sql
-- ä½¿ç”¨ LEFT JOIN æ‰¾å‡ºç¼ºå¤±å­—æ®µ
SELECT t.TABLE_NAME, ref.COLUMN_NAME
FROM information_schema.TABLES t
CROSS JOIN information_schema.COLUMNS ref  -- æ ‡å‡†è¡¨çš„æ‰€æœ‰å­—æ®µ
LEFT JOIN information_schema.COLUMNS exist  -- å½“å‰è¡¨çš„å­—æ®µ
    ON exist.TABLE_NAME = t.TABLE_NAME
    AND exist.COLUMN_NAME = ref.COLUMN_NAME
WHERE ref.TABLE_NAME = 'aa_example'  -- æ ‡å‡†è¡¨
    AND t.TABLE_NAME LIKE 'aa%'      -- åŒå‰ç¼€çš„è¡¨
    AND exist.COLUMN_NAME IS NULL    -- å­—æ®µä¸å­˜åœ¨
```

### ALTER TABLE è¯­å¥ç”Ÿæˆ

ç”Ÿæˆçš„ä¿®å¤è¯­å¥åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- å­—æ®µå
- å­—æ®µç±»å‹ï¼ˆå®Œæ•´ç±»å‹ï¼Œå¦‚ `varchar(100)`ï¼‰
- æ˜¯å¦å¯ç©ºï¼ˆ`NULL` / `NOT NULL`ï¼‰
- é»˜è®¤å€¼ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€CURRENT_TIMESTAMP ç­‰ï¼‰
- é¢å¤–å±æ€§ï¼ˆå¦‚ `auto_increment`ï¼‰
- å­—æ®µæ³¨é‡Šï¼ˆ`COMMENT`ï¼‰
- å­—æ®µä½ç½®ï¼ˆ`AFTER column_name` æˆ– `FIRST`ï¼‰

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæˆ‘çš„æŸ¥è¯¢æ²¡æœ‰è¿”å›ç»“æœï¼Ÿ

A: è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. `@db_name` æ˜¯å¦å¡«å†™æ­£ç¡®
2. `@table_prefix` æ˜¯å¦ä¸å®é™…è¡¨å‰ç¼€ä¸€è‡´
3. `@standard_table` æ˜¯å¦å­˜åœ¨
4. æ˜¯å¦æœ‰ `information_schema` çš„æŸ¥è¯¢æƒé™

### Q2: ç”Ÿæˆçš„SQLè¯­å¥æ‰§è¡Œå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: å¯èƒ½çš„åŸå› ï¼š
1. å­—æ®µå·²å­˜åœ¨ï¼ˆé‡å¤æ‰§è¡Œï¼‰
2. æƒé™ä¸è¶³
3. è¡¨è¢«é”å®š
4. é»˜è®¤å€¼ä¸å­—æ®µç±»å‹ä¸å…¼å®¹

### Q3: å¦‚ä½•åªæ£€æŸ¥ä¸ä¿®å¤ï¼Ÿ

A: åªæ‰§è¡Œæ­¥éª¤1-4ï¼Œä¸æ‰§è¡Œæ­¥éª¤5-6å³å¯ã€‚

### Q4: æ”¯æŒMySQL 8.0å—ï¼Ÿ

A: æ”¯æŒã€‚æœ¬å·¥å…·ä½¿ç”¨æ ‡å‡†çš„ `information_schema`ï¼Œå…¼å®¹MySQL 5.7åŠä»¥ä¸Šç‰ˆæœ¬ã€‚

### Q5: å¦‚ä½•å¤„ç†æœ‰å¤–é”®çº¦æŸçš„è¡¨ï¼Ÿ

A: å»ºè®®å…ˆä¸´æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥ï¼š
```sql
SET FOREIGN_KEY_CHECKS = 0;
-- æ‰§è¡Œä¿®å¤SQL
SET FOREIGN_KEY_CHECKS = 1;
```

---

## æœ€ä½³å®è·µ

### æ‰§è¡Œå‰

1. **å¤‡ä»½æ•°æ®åº“** - åœ¨æ‰§è¡Œä»»ä½•DDLä¹‹å‰
2. **åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯** - å…ˆåœ¨éç”Ÿäº§ç¯å¢ƒæµ‹è¯•
3. **é€‰æ‹©ä½å³°æœŸ** - å¤§è¡¨DDLå¯èƒ½é”è¡¨

### æ‰§è¡Œä¸­

1. **é€æ¡æ‰§è¡Œ** - ä¸è¦ä¸€æ¬¡æ‰§è¡Œæ‰€æœ‰è¯­å¥
2. **è§‚å¯Ÿæ‰§è¡Œæ—¶é—´** - å¤§è¡¨æ“ä½œå¯èƒ½è€—æ—¶è¾ƒé•¿
3. **ç›‘æ§æ•°æ®åº“çŠ¶æ€** - æ³¨æ„é”ç­‰å¾…æƒ…å†µ

### æ‰§è¡Œå

1. **éªŒè¯ç»“æ„** - é‡æ–°è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®è®¤ä¿®å¤å®Œæˆ
2. **æµ‹è¯•åº”ç”¨** - ç¡®ä¿åº”ç”¨åŠŸèƒ½æ­£å¸¸
3. **è®°å½•å˜æ›´** - ä¿å­˜æœ¬æ¬¡æ“ä½œçš„è®°å½•

### æ¨èå·¥ä½œæµ

```
1. ä¿®æ”¹é…ç½®å‚æ•°
      â†“
2. æ‰§è¡Œå®Œæ•´æ£€æŸ¥è„šæœ¬
      â†“
3. åˆ†æè¾“å‡ºç»“æœ
      â†“
4. å¤åˆ¶æ­¥éª¤6çš„SQLï¼ˆæ¨èç‰ˆï¼‰
      â†“
5. åœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡ŒéªŒè¯
      â†“
6. åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œä¿®å¤
      â†“
7. é‡æ–°è¿è¡Œæ£€æŸ¥ç¡®è®¤
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| v1.0 | 2024-01-01 | åˆå§‹ç‰ˆæœ¬ï¼Œ5æ­¥æ£€æŸ¥æµç¨‹ |
| v2.0 | 2024-06-01 | æ”¯æŒä»»æ„å‰ç¼€ã€å¢å¼ºæ˜¾ç¤ºã€æ±‡æ€»æŠ¥å‘Š |
| v2.1 | 2025-11-26 | æ·»åŠ å®Œæ•´ä½¿ç”¨æŒ‡å—æ–‡æ¡£ |

---

## è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

---

> ğŸ’¡ **æç¤º**ï¼šæ¨èä½¿ç”¨ `check_table_structure_v2.sql` ç‰ˆæœ¬ï¼ŒåŠŸèƒ½æ›´å®Œæ•´ã€‚
