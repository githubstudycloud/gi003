# 动态报告生成系统

一个灵活的报告生成系统,支持混淆矩阵分析和场景/因子评估。

## 功能特点

### 1. 双报告类型支持
- **分类预测混淆矩阵统计报告**: 用于分析预测值与实际值的匹配情况
- **场景/因子评估报告**: 用于评估不同场景和因子的表现

### 2. 动态字段映射
- 从JSON数据中自动识别可用字段
- 灵活选择预期值、实际值和显示说明字段
- 支持不同字段组合,适应各种数据结构

### 3. 混淆矩阵特性
- **矩阵最值策略**:
  - 自动计算: 根据数据自动确定矩阵大小
  - 手动设置: 自定义矩阵维度(1-1000)

- **空值处理策略**:
  - 记为0: 将空值转换为0
  - 抛弃: 跳过包含空值的数据
  - 报异常: 遇到空值时停止计算并报错

- **详细指标**:
  - 召回率(Recall)
  - 精准率(Precision)
  - 总准确率(Accuracy)
  - 混淆矩阵可视化

### 4. 增强的矩阵展示
- 左侧第一列显示实际值的说明文字
- 点击任意单元格查看详细数据
- 颜色编码:
  - 绿色: 预测正确(对角线)
  - 黄色: 预测错误
  - 灰色: 无数据
- 召回率和精准率颜色指示:
  - 绿色: ≥90%
  - 橙色: 70-90%
  - 红色: <70%

## 使用方法

### 1. 打开主页面
在浏览器中打开 `index.html`

### 2. 填写报告基本信息
- 报告名称: 例如 "Q4用户行为分析"
- 版本名称: 例如 "v1.0.0"

### 3. 选择报告类型
- 场景/因子评估报告
- 分类预测混淆矩阵统计报告

### 4. 导入数据
#### 方式一: 上传JSON文件
点击"选择JSON文件"按钮,选择符合格式的JSON文件

#### 方式二: 使用示例数据
点击"使用示例数据"按钮,系统会自动生成200条示例数据

### 5. 配置混淆矩阵(仅矩阵报告)
1. **选择字段映射**:
   - 预期值字段: 选择包含预期结果的字段
   - 实际值字段: 选择包含实际结果的字段
   - 实际值显示说明字段: 选择用于显示的说明文字字段

2. **设置矩阵最值策略**:
   - 自动计算: 推荐选项
   - 手动设置: 输入具体数值

3. **选择空值处理策略**:
   - 记为0: 适合允许0值的场景
   - 抛弃: 适合数据质量高的场景
   - 报异常: 适合需要严格数据校验的场景

### 6. 生成报告
点击"生成报告"按钮,系统会自动跳转到对应的报告页面

## 数据格式要求

JSON文件必须是对象数组格式,示例:

```json
[
  {
    "id": 1,
    "expected_level": 3,
    "actual_level": 3,
    "level_name": "中等",
    "scenario": "电商推荐",
    "factor": "用户活跃度",
    "score": 85
  },
  {
    "id": 2,
    "expected_level": 5,
    "actual_level": 4,
    "level_name": "较高",
    "scenario": "内容推荐",
    "factor": "点击率",
    "score": 78
  }
]
```

### 字段说明
- 必须是数组格式
- 数组元素必须是对象
- 每个对象的key将作为可选字段显示
- 对于混淆矩阵报告:
  - 预期值和实际值字段必须是数值类型或可转换为数值
  - 显示说明字段可以是任意类型

## 报告功能

### 混淆矩阵报告
- 查看整体统计: 总样本数、正确数、错误数、准确率
- 查看混淆矩阵: 实际值 vs 预测值的交叉分析
- 查看详细指标: 每个值的召回率和精准率
- 点击单元格: 查看该单元格包含的所有原始数据
- 导出报告: 保存报告数据(开发中)

### 场景/因子评估报告
- 查看整体统计: 数据总量、场景数量、因子数量
- 查看详细数据表格: 展示所有原始数据

## 文件结构

```
dynamic-report-system/
├── index.html              # 主页面
├── matrix-report.html      # 混淆矩阵报告页面
├── scenario-report.html    # 场景/因子报告页面
├── css/
│   ├── common.css         # 通用样式
│   ├── index.css          # 主页面样式
│   ├── matrix.css         # 矩阵报告样式
│   └── scenario.css       # 场景报告样式
├── js/
│   ├── common.js          # 通用工具函数
│   ├── index.js           # 主页面逻辑
│   ├── matrix-report.js   # 矩阵报告逻辑
│   └── scenario-report.js # 场景报告逻辑
├── data/
│   └── sample-data.json   # 示例数据
└── README.md              # 说明文档
```

## 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 注意事项

1. 数据存储在浏览器localStorage中,清除浏览器缓存会丢失数据
2. 大数据量(>10000条)可能影响性能
3. 建议在选择字段时,确保预期值和实际值字段包含数值数据
4. 矩阵大小建议不超过100,过大的矩阵会影响显示效果

## 开发计划

- [ ] Excel导出功能
- [ ] PDF导出功能
- [ ] 数据可视化图表
- [ ] 多报告对比功能
- [ ] 历史报告管理
