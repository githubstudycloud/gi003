<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··æ·†çŸ©é˜µæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ - å•æ–‡ä»¶ç‰ˆ</title>
    <style>
        /* é€šç”¨æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #409EFF;
            --success-color: #67C23A;
            --warning-color: #E6A23C;
            --danger-color: #F56C6C;
            --info-color: #909399;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --border-color: #dcdfe6;
            --text-primary: #303133;
            --text-regular: #606266;
            --text-secondary: #909399;
            --shadow-base: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            outline: none;
            font-weight: 500;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-warning { background: var(--warning-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-info { background: var(--info-color); color: white; }
        .btn-secondary { background: #f4f4f5; color: var(--text-regular); border: 1px solid var(--border-color); }
        .btn-large { padding: 14px 40px; font-size: 16px; }

        /* å¤´éƒ¨ */
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        header h1 { font-size: 32px; margin-bottom: 10px; }
        header .subtitle { font-size: 16px; opacity: 0.95; }

        /* è¡¨å•æ ·å¼ */
        .section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-base);
        }

        .section h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 18px;
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-item { margin-bottom: 20px; }
        .form-item label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-regular);
            font-weight: 500;
        }

        .form-item input[type="text"],
        .form-item input[type="number"],
        .form-item select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-item input:focus, .form-item select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .required { color: var(--danger-color); }

        /* ç¤ºä¾‹æ•°æ®é€‰æ‹©å™¨ */
        .sample-data-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            padding: 16px;
            background: #f9fafb;
            border-radius: 6px;
            border: 1px dashed var(--border-color);
            margin-top: 16px;
        }

        .sample-data-selector label {
            color: var(--text-regular);
            font-weight: 500;
            margin: 0;
        }

        /* æ•°æ®é¢„è§ˆ */
        .data-preview {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            background: #f9fafb;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px;
        }

        .data-preview pre {
            margin: 0;
            font-size: 12px;
            color: var(--text-regular);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .stat-card {
            padding: 16px;
            border-radius: 6px;
            text-align: center;
            background: white;
            box-shadow: var(--shadow-base);
            border-left: 4px solid var(--primary-color);
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .stat-card .label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* æ“ä½œåŒºåŸŸ */
        .action-section {
            text-align: center;
            padding: 40px 0 20px 0;
        }

        /* é…ç½®ç»„ */
        .config-group {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 6px;
        }

        .config-group h3 {
            color: var(--text-regular);
            margin-bottom: 16px;
            font-size: 16px;
        }

        /* ç­–ç•¥é€‰æ‹©å™¨ */
        .strategy-selector {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-inline {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .radio-inline:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }

        /* æŠ¥å‘Šé¡µé¢ */
        .report-header {
            background: white;
            color: #333;
            padding: 24px;
            margin-bottom: 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-base);
        }

        .report-header h1 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 12px;
            color: #333;
        }

        .report-meta {
            text-align: center;
            font-size: 14px;
            color: #666;
        }

        .report-meta span { margin: 0 8px; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-total { border-left-color: #409EFF; }
        .stat-correct { border-left-color: #67C23A; }
        .stat-wrong { border-left-color: #F56C6C; }
        .stat-accuracy { border-left-color: #E6A23C; }

        /* çŸ©é˜µè¡¨æ ¼ */
        .matrix-wrapper {
            overflow-x: auto;
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-base);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            min-width: 800px;
        }

        .matrix-table th,
        .matrix-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: center;
            min-width: 60px;
        }

        .matrix-table th {
            background: #409EFF;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* å·¦ä¾§åˆ—æ ·å¼ */
        .matrix-table .label-cell {
            background: #f0f9ff;
            font-weight: 600;
            text-align: left;
            padding-left: 15px;
            min-width: 150px;
            position: sticky;
            left: 0;
            z-index: 5;
            border-right: 2px solid #ddd;
        }

        .matrix-table th.label-header {
            background: #67C23A;
            position: sticky;
            left: 0;
            z-index: 15;
            text-align: left;
            padding-left: 15px;
        }

        .matrix-table .value-cell {
            background: #f0f9ff;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
            position: sticky;
            left: 150px;
            z-index: 5;
        }

        .matrix-table th.value-header {
            background: #67C23A;
            position: sticky;
            left: 150px;
            z-index: 15;
        }

        /* çŸ©é˜µå•å…ƒæ ¼ */
        .cell-correct {
            background: #d4edda !important;
            color: #155724;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cell-error {
            background: #fff3cd;
            color: #856404;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cell-zero {
            background: #f8f9fa;
            color: #aaa;
        }

        .cell-clickable:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1;
        }

        /* ç»Ÿè®¡åˆ— */
        .sum-column {
            background: #e7f3ff !important;
            font-weight: bold;
        }

        .recall-column, .precision-column {
            background: #e8f5e9 !important;
            font-weight: bold;
        }

        .recall-high { color: #2e7d32; }
        .recall-medium { color: #f57c00; }
        .recall-low { color: #c62828; }

        /* ç»Ÿè®¡è¡Œ */
        .sum-row td {
            background: #e7f3ff !important;
            font-weight: bold;
        }

        .precision-row td {
            background: #e8f5e9 !important;
            font-weight: bold;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 0;
            width: 90%;
            max-width: 1000px;
            border-radius: 8px;
            max-height: 85vh;
            overflow: hidden;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: #f9fafb;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover { color: #000; }

        .modal-body {
            padding: 24px;
            max-height: calc(85vh - 80px);
            overflow-y: auto;
        }

        .detail-info {
            margin-bottom: 20px;
            padding: 16px;
            background: #f0f7ff;
            border-radius: 6px;
        }

        .detail-info p {
            margin: 8px 0;
            font-size: 14px;
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }

        .detail-table th,
        .detail-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
            font-size: 13px;
        }

        .detail-table th {
            background: #f5f7fa;
            font-weight: 600;
            color: var(--text-regular);
        }

        .detail-table tr:hover {
            background: #f9fafb;
        }

        .badge-pass {
            background: #67C23A;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }

        .badge-fail {
            background: #F56C6C;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
        }

        /* æ¶ˆæ¯æç¤º */
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 4px;
            color: white;
            font-size: 14px;
            z-index: 9999;
            animation: slideDown 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, -100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        .message-success { background: var(--success-color); }
        .message-error { background: var(--danger-color); }
        .message-warning { background: var(--warning-color); }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .section { padding: 16px; }
            header h1 { font-size: 24px; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é…ç½®é¡µé¢ -->
        <div id="configPage" class="page active">
            <header>
                <h1>ğŸ“Š æ··æ·†çŸ©é˜µæŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ</h1>
                <p class="subtitle">åŠ¨æ€é…ç½®å­—æ®µæ˜ å°„ï¼Œä¸€é”®ç”Ÿæˆä¸“ä¸šæ··æ·†çŸ©é˜µåˆ†ææŠ¥å‘Š</p>
            </header>

            <main>
                <!-- æŠ¥å‘ŠåŸºæœ¬ä¿¡æ¯ -->
                <section class="section">
                    <h2>ğŸ“ æŠ¥å‘ŠåŸºæœ¬ä¿¡æ¯</h2>
                    <div class="form-grid">
                        <div class="form-item">
                            <label for="reportName">æŠ¥å‘Šåç§° <span class="required">*</span></label>
                            <input type="text" id="reportName" placeholder="è¯·è¾“å…¥æŠ¥å‘Šåç§°" value="åˆ†ç±»é¢„æµ‹æ··æ·†çŸ©é˜µåˆ†æ">
                        </div>
                        <div class="form-item">
                            <label for="versionName">ç‰ˆæœ¬åç§° <span class="required">*</span></label>
                            <input type="text" id="versionName" placeholder="ä¾‹å¦‚: v1.0.0" value="v1.0.0">
                        </div>
                    </div>
                </section>

                <!-- æ•°æ®å¯¼å…¥ -->
                <section class="section">
                    <h2>ğŸ“‚ æ•°æ®å¯¼å…¥</h2>
                    <div class="sample-data-selector">
                        <label>é€‰æ‹©ç¤ºä¾‹æ•°æ®:</label>
                        <button class="btn btn-info" onclick="loadSampleData(10)">
                            ğŸ² 10ç»´çŸ©é˜µ (200æ¡)
                        </button>
                        <button class="btn btn-success" onclick="loadSampleData(15)">
                            â­ 15ç»´çŸ©é˜µ (300æ¡) - é«˜è´¨é‡
                        </button>
                        <button class="btn btn-info" onclick="loadSampleData(20)">
                            ğŸ² 20ç»´çŸ©é˜µ (206æ¡)
                        </button>
                        <button class="btn btn-info" onclick="loadSampleData(30)">
                            ğŸ² 30ç»´çŸ©é˜µ (394æ¡)
                        </button>
                    </div>
                    <div id="dataPreview" class="data-preview"></div>
                </section>

                <!-- çŸ©é˜µé…ç½® -->
                <section id="matrixConfig" class="section">
                    <h2>âš™ï¸ çŸ©é˜µé…ç½®</h2>

                    <!-- åŠ¨æ€å­—æ®µé€‰æ‹© -->
                    <div class="config-group">
                        <h3>ğŸ”— åŠ¨æ€å­—æ®µæ˜ å°„</h3>
                        <div class="form-grid">
                            <div class="form-item">
                                <label for="expectedField">1. é¢„æœŸå€¼å­—æ®µ <span class="required">*</span></label>
                                <select id="expectedField">
                                    <option value="">-- è¯·å…ˆåŠ è½½æ•°æ® --</option>
                                </select>
                            </div>
                            <div class="form-item">
                                <label for="actualField">2. å®é™…å€¼å­—æ®µ <span class="required">*</span></label>
                                <select id="actualField">
                                    <option value="">-- è¯·å…ˆåŠ è½½æ•°æ® --</option>
                                </select>
                            </div>
                            <div class="form-item">
                                <label for="labelField">3. å®é™…å€¼æ˜¾ç¤ºè¯´æ˜å­—æ®µ <span class="required">*</span></label>
                                <select id="labelField">
                                    <option value="">-- è¯·å…ˆåŠ è½½æ•°æ® --</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- æœ€å€¼ç­–ç•¥ -->
                    <div class="config-group">
                        <h3>ğŸ“Š çŸ©é˜µæœ€å€¼ç­–ç•¥</h3>
                        <div class="strategy-selector">
                            <label class="radio-inline">
                                <input type="radio" name="maxStrategy" value="auto" checked>
                                <span>è‡ªåŠ¨è®¡ç®—æœ€å¤§å€¼ (ä»é¢„æœŸå€¼å’Œå®é™…å€¼ä¸­è‡ªåŠ¨è®¡ç®—)</span>
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="maxStrategy" value="manual">
                                <span>æ‰‹åŠ¨è®¾ç½®æœ€å¤§å€¼:</span>
                                <input type="number" id="manualMax" min="1" value="10" disabled>
                            </label>
                        </div>
                    </div>

                    <!-- ç©ºå€¼å¤„ç†ç­–ç•¥ -->
                    <div class="config-group">
                        <h3>ğŸ”§ ç©ºå€¼/å¼‚å¸¸å€¼å¤„ç†ç­–ç•¥</h3>
                        <div class="strategy-selector">
                            <label class="radio-inline">
                                <input type="radio" name="nullStrategy" value="zero" checked>
                                <span>è®°ä¸º0 (å°†ç©ºå€¼è§†ä¸º0å¤„ç†)</span>
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="nullStrategy" value="discard">
                                <span>æŠ›å¼ƒ (å¿½ç•¥åŒ…å«ç©ºå€¼çš„è®°å½•)</span>
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="nullStrategy" value="error">
                                <span>æŠ¥å¼‚å¸¸ (å‘ç°ç©ºå€¼æ—¶åœæ­¢å¹¶æŠ¥é”™)</span>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- ç”ŸæˆæŒ‰é’® -->
                <div class="action-section">
                    <button class="btn btn-primary btn-large" onclick="generateReport()">
                        ğŸš€ ç”Ÿæˆæ··æ·†çŸ©é˜µæŠ¥å‘Š
                    </button>
                </div>
            </main>
        </div>

        <!-- æŠ¥å‘Šé¡µé¢ -->
        <div id="reportPage" class="page">
            <div class="report-header">
                <button class="btn btn-secondary" onclick="goBack()">
                    â† è¿”å›é…ç½®
                </button>
                <h1 id="reportTitle">æ··æ·†çŸ©é˜µæŠ¥å‘Š</h1>
                <div class="report-meta" id="reportMeta"></div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats-section">
                <div class="stat-card stat-total">
                    <div class="value" id="totalCount">0</div>
                    <div class="label">æ€»æ ·æœ¬æ•°</div>
                </div>
                <div class="stat-card stat-correct">
                    <div class="value" id="correctCount">0</div>
                    <div class="label">é¢„æµ‹æ­£ç¡®æ•°</div>
                </div>
                <div class="stat-card stat-wrong">
                    <div class="value" id="wrongCount">0</div>
                    <div class="label">é¢„æµ‹é”™è¯¯æ•°</div>
                </div>
                <div class="stat-card stat-accuracy">
                    <div class="value" id="accuracy">0%</div>
                    <div class="label">æ€»å‡†ç¡®ç‡</div>
                </div>
            </div>

            <!-- æ··æ·†çŸ©é˜µ -->
            <div class="matrix-wrapper">
                <table class="matrix-table" id="matrixTable"></table>
            </div>
        </div>
    </div>

    <!-- è¯¦ç»†æ•°æ®æ¨¡æ€æ¡† -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ” å•å…ƒæ ¼è¯¦ç»†æ•°æ®</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentData = null;
        let reportConfig = null;
        let matrixData = null;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç›‘å¬æœ€å€¼ç­–ç•¥åˆ‡æ¢
            const maxStrategyRadios = document.querySelectorAll('input[name="maxStrategy"]');
            maxStrategyRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const manualInput = document.getElementById('manualMax');
                    manualInput.disabled = !document.querySelector('input[name="maxStrategy"][value="manual"]').checked;
                });
            });
        });

        // ç”ŸæˆåŠ¨æ€æ•°æ® (å¸¸è§„80%å‡†ç¡®ç‡)
        function generateDynamicData(dimensions, count) {
            const levelNames = generateLevelNames(dimensions);
            const scenarios = ['ç”µå•†æ¨è', 'å†…å®¹æ¨è', 'æœç´¢æ’åº', 'å¹¿å‘ŠæŠ•æ”¾', 'æ™ºèƒ½å®¢æœ'];
            const factors = ['ç”¨æˆ·æ´»è·ƒåº¦', 'ç‚¹å‡»ç‡', 'è½¬åŒ–ç‡', 'ç•™å­˜ç‡', 'ROI', 'CTR', 'CVR', 'æ»¡æ„åº¦', 'NPS', 'å¤è´­ç‡'];

            const data = [];
            const samplesPerLevel = Math.floor(count / dimensions);
            const extraSamples = count % dimensions;

            let id = 1;
            for (let level = 0; level < dimensions; level++) {
                const numSamples = samplesPerLevel + (level < extraSamples ? 1 : 0);

                for (let j = 0; j < numSamples; j++) {
                    let actual;
                    if (Math.random() < 0.80) {
                        actual = level;
                    } else {
                        const offset = Math.random() < 0.5 ?
                            (Math.random() < 0.5 ? -1 : 1) :
                            (Math.random() < 0.5 ? -2 : 2);
                        actual = Math.max(0, Math.min(dimensions - 1, level + offset));
                    }

                    data.push({
                        id: id++,
                        expected_level: level,
                        actual_level: actual,
                        level_name: levelNames[level],
                        scenario: scenarios[Math.floor(Math.random() * scenarios.length)],
                        factor: factors[Math.floor(Math.random() * factors.length)],
                        score: Math.floor(Math.random() * 40) + 60,
                        timestamp: `2025-11-25 ${Math.floor(Math.random() * 13) + 8}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`
                    });
                }
            }

            // æ‰“ä¹±æ•°æ®
            for (let i = data.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [data[i], data[j]] = [data[j], data[i]];
            }

            return data;
        }

        // ç”Ÿæˆé«˜è´¨é‡æ•°æ® (çŸ©é˜µå•å…ƒæ ¼0å€¼å°½å¯èƒ½å°‘)
        function generateHighQualityData(dimensions, count) {
            const levelNames = generateLevelNames(dimensions);
            const scenarios = ['ç”µå•†æ¨è', 'å†…å®¹æ¨è', 'æœç´¢æ’åº', 'å¹¿å‘ŠæŠ•æ”¾', 'æ™ºèƒ½å®¢æœ', 'AIåŠ©æ‰‹', 'ä¸ªæ€§åŒ–æ¨é€'];
            const factors = ['ç”¨æˆ·æ´»è·ƒåº¦', 'ç‚¹å‡»ç‡', 'è½¬åŒ–ç‡', 'ç•™å­˜ç‡', 'ROI', 'CTR', 'CVR', 'æ»¡æ„åº¦', 'NPS', 'å¤è´­ç‡', 'å‚ä¸åº¦', 'å“åº”ç‡'];

            const data = [];
            let id = 1;

            const totalCells = dimensions * dimensions;
            const matrixDistribution = [];

            // æ¯ä¸ªå•å…ƒæ ¼è‡³å°‘1æ¡æ•°æ®
            for (let expected = 0; expected < dimensions; expected++) {
                for (let actual = 0; actual < dimensions; actual++) {
                    matrixDistribution.push({ expected, actual, count: 1 });
                }
            }

            // å‰©ä½™æ•°æ®åˆ†é…
            let remainingCount = count - totalCells;
            const diagonalCount = Math.floor(remainingCount * 0.60);
            const adjacentCount = Math.floor(remainingCount * 0.30);
            const otherCount = remainingCount - diagonalCount - adjacentCount;

            // å¯¹è§’çº¿
            for (let i = 0; i < dimensions; i++) {
                const cell = matrixDistribution.find(c => c.expected === i && c.actual === i);
                cell.count += Math.floor(diagonalCount / dimensions);
            }

            // ç›¸é‚»å¯¹è§’çº¿
            let adjacentCells = [];
            for (let i = 0; i < dimensions; i++) {
                if (i > 0) adjacentCells.push({ expected: i, actual: i - 1 });
                if (i < dimensions - 1) adjacentCells.push({ expected: i, actual: i + 1 });
            }
            const perAdjacentCell = Math.floor(adjacentCount / adjacentCells.length);
            adjacentCells.forEach(pos => {
                const cell = matrixDistribution.find(c => c.expected === pos.expected && c.actual === pos.actual);
                cell.count += perAdjacentCell;
            });

            // å…¶ä»–ä½ç½®éšæœºåˆ†é…
            for (let i = 0; i < otherCount; i++) {
                const randomCell = matrixDistribution[Math.floor(Math.random() * matrixDistribution.length)];
                randomCell.count++;
            }

            // ç”Ÿæˆå®é™…æ•°æ®
            matrixDistribution.forEach(cell => {
                for (let i = 0; i < cell.count; i++) {
                    data.push({
                        id: id++,
                        expected_level: cell.expected,
                        actual_level: cell.actual,
                        level_name: levelNames[cell.expected],
                        scenario: scenarios[Math.floor(Math.random() * scenarios.length)],
                        factor: factors[Math.floor(Math.random() * factors.length)],
                        score: Math.floor(Math.random() * 30) + 70,
                        timestamp: `2025-11-25 ${Math.floor(Math.random() * 13) + 8}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')}`
                    });
                }
            });

            // æ‰“ä¹±æ•°æ®
            for (let i = data.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [data[i], data[j]] = [data[j], data[i]];
            }

            return data;
        }

        // ç”Ÿæˆç­‰çº§åç§°
        function generateLevelNames(dimensions) {
            const baseNames = [
                'æä½', 'å¾ˆä½', 'ä½', 'è¾ƒä½', 'åä½',
                'ä¸­ä¸‹', 'ä¸­ç­‰', 'ä¸­ä¸Š', 'åé«˜', 'è¾ƒé«˜',
                'é«˜', 'å¾ˆé«˜', 'æé«˜', 'ä¼˜ç§€', 'å“è¶Š',
                'å®Œç¾', 'S-', 'S', 'S+', 'SS-',
                'SS', 'SS+', 'SSS-', 'SSS', 'SSS+',
                'ä¼ å¥‡-', 'ä¼ å¥‡', 'ä¼ å¥‡+', 'ç¥è¯', 'å·…å³°'
            ];

            if (dimensions <= 30) {
                return baseNames.slice(0, dimensions);
            }

            const names = [...baseNames];
            for (let i = 30; i < dimensions; i++) {
                names.push(`ç­‰çº§${i}`);
            }
            return names;
        }

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData(dimensions) {
            let data, description, count;

            switch(dimensions) {
                case 10:
                    count = 200;
                    description = '10ç»´çŸ©é˜µ (200æ¡)';
                    data = generateDynamicData(10, count);
                    break;
                case 15:
                    count = 300;
                    description = '15ç»´çŸ©é˜µ (300æ¡) - é«˜è´¨é‡';
                    data = generateHighQualityData(15, count);
                    break;
                case 20:
                    count = 206;
                    description = '20ç»´çŸ©é˜µ (206æ¡)';
                    data = generateDynamicData(20, count);
                    break;
                case 30:
                    count = 394;
                    description = '30ç»´çŸ©é˜µ (394æ¡)';
                    data = generateDynamicData(30, count);
                    break;
            }

            currentData = data;
            displayDataPreview(data);
            populateFieldSelectors(data);
            showMessage(`${description} æ•°æ®åŠ è½½æˆåŠŸ!`, 'success');
        }

        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
        function displayDataPreview(data) {
            const preview = document.getElementById('dataPreview');
            const previewData = data.slice(0, 3);

            let html = '<div class="data-stats">';
            html += `<div class="stat-card"><div class="value">${data.length}</div><div class="label">æ€»æ•°æ®æ¡æ•°</div></div>`;
            html += `<div class="stat-card"><div class="value">${Object.keys(data[0]).length}</div><div class="label">å­—æ®µæ•°é‡</div></div>`;
            html += '</div>';
            html += '<pre>' + JSON.stringify(previewData, null, 2) + '</pre>';
            if (data.length > 3) {
                html += `<p style="text-align:center; color: #909399; margin-top: 10px;">... è¿˜æœ‰ ${data.length - 3} æ¡æ•°æ®</p>`;
            }

            preview.innerHTML = html;
        }

        // å¡«å……å­—æ®µé€‰æ‹©å™¨
        function populateFieldSelectors(data) {
            if (!data || data.length === 0) return;

            const fields = Object.keys(data[0]);
            const selectors = ['expectedField', 'actualField', 'labelField'];

            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                selector.innerHTML = '<option value="">-- è¯·é€‰æ‹©å­—æ®µ --</option>';
                fields.forEach(field => {
                    selector.innerHTML += `<option value="${field}">${field}</option>`;
                });
            });

            // è‡ªåŠ¨é€‰æ‹©é»˜è®¤å€¼
            document.getElementById('expectedField').value = 'expected_level';
            document.getElementById('actualField').value = 'actual_level';
            document.getElementById('labelField').value = 'level_name';
        }

        // ç”ŸæˆæŠ¥å‘Š
        function generateReport() {
            const reportName = document.getElementById('reportName').value.trim();
            const versionName = document.getElementById('versionName').value.trim();

            if (!reportName || !versionName) {
                showMessage('è¯·è¾“å…¥æŠ¥å‘Šåç§°å’Œç‰ˆæœ¬åç§°', 'warning');
                return;
            }

            if (!currentData) {
                showMessage('è¯·å…ˆåŠ è½½æ•°æ®', 'warning');
                return;
            }

            const expectedField = document.getElementById('expectedField').value;
            const actualField = document.getElementById('actualField').value;
            const labelField = document.getElementById('labelField').value;

            if (!expectedField || !actualField || !labelField) {
                showMessage('è¯·é€‰æ‹©æ‰€æœ‰å¿…å¡«å­—æ®µ', 'warning');
                return;
            }

            if (expectedField === actualField || expectedField === labelField || actualField === labelField) {
                showMessage('å­—æ®µä¸èƒ½é‡å¤é€‰æ‹©', 'warning');
                return;
            }

            const maxStrategy = document.querySelector('input[name="maxStrategy"]:checked').value;
            const manualMax = parseInt(document.getElementById('manualMax').value);
            const nullStrategy = document.querySelector('input[name="nullStrategy"]:checked').value;

            reportConfig = {
                reportName,
                versionName,
                expectedField,
                actualField,
                labelField,
                maxStrategy,
                manualMax,
                nullStrategy,
                generateTime: new Date().toLocaleString('zh-CN')
            };

            processMatrixData();
            showReportPage();
        }

        // å¤„ç†çŸ©é˜µæ•°æ®
        function processMatrixData() {
            const { expectedField, actualField, labelField, maxStrategy, manualMax, nullStrategy } = reportConfig;

            // è®¡ç®—çŸ©é˜µå¤§å°
            let maxValue = 0;
            if (maxStrategy === 'manual') {
                maxValue = manualMax;
            } else {
                currentData.forEach(item => {
                    const exp = item[expectedField];
                    const act = item[actualField];
                    if (exp !== null && exp !== undefined) maxValue = Math.max(maxValue, exp);
                    if (act !== null && act !== undefined) maxValue = Math.max(maxValue, act);
                });
            }

            const matrixSize = maxValue + 1;

            // åˆå§‹åŒ–çŸ©é˜µ
            const matrix = Array(matrixSize).fill(0).map(() => Array(matrixSize).fill(0));
            const labelMap = {};
            const cellDetails = {};

            // å¡«å……çŸ©é˜µ
            currentData.forEach(item => {
                const exp = item[expectedField];
                const act = item[actualField];
                const label = item[labelField];

                if (exp === null || exp === undefined || act === null || act === undefined) {
                    if (nullStrategy === 'error') {
                        throw new Error('æ•°æ®ä¸­åŒ…å«ç©ºå€¼');
                    } else if (nullStrategy === 'discard') {
                        return;
                    }
                }

                if (exp >= 0 && exp < matrixSize && act >= 0 && act < matrixSize) {
                    matrix[exp][act]++;
                    labelMap[exp] = label || `ç­‰çº§${exp}`;

                    const key = `${exp}_${act}`;
                    if (!cellDetails[key]) {
                        cellDetails[key] = [];
                    }
                    cellDetails[key].push(item);
                }
            });

            matrixData = { matrix, matrixSize, labelMap, cellDetails };
        }

        // æ˜¾ç¤ºæŠ¥å‘Šé¡µé¢
        function showReportPage() {
            document.getElementById('configPage').classList.remove('active');
            document.getElementById('reportPage').classList.add('active');

            document.getElementById('reportTitle').textContent = reportConfig.reportName;
            document.getElementById('reportMeta').innerHTML = `
                <span>ç‰ˆæœ¬: ${reportConfig.versionName}</span>
                <span>ç”Ÿæˆæ—¶é—´: ${reportConfig.generateTime}</span>
            `;

            renderMatrix();
            calculateStatistics();
        }

        // æ¸²æŸ“çŸ©é˜µ
        function renderMatrix() {
            const { matrix, matrixSize, labelMap } = matrixData;
            const table = document.getElementById('matrixTable');

            let html = '<thead><tr>';
            html += '<th class="label-header">æ˜¾ç¤ºè¯´æ˜</th>';
            html += '<th class="value-header">å®é™…\\é¢„æµ‹</th>';
            for (let i = 0; i < matrixSize; i++) {
                html += `<th>${i}</th>`;
            }
            html += '<th>åˆè®¡</th>';
            html += '<th>å¬å›ç‡</th>';
            html += '</tr></thead>';

            html += '<tbody>';

            // æ•°æ®è¡Œ
            for (let i = 0; i < matrixSize; i++) {
                html += '<tr>';

                const label = labelMap[i] || `å€¼${i}`;
                html += `<td class="label-cell">${label}</td>`;
                html += `<td class="value-cell">${i}</td>`;

                let rowSum = 0;
                for (let j = 0; j < matrixSize; j++) {
                    const value = matrix[i][j];
                    rowSum += value;

                    let cellClass = value > 0 ? 'cell-clickable ' : '';
                    if (value === 0) {
                        cellClass += 'cell-zero';
                    } else if (i === j) {
                        cellClass += 'cell-correct';
                    } else {
                        cellClass += 'cell-error';
                    }

                    html += `<td class="${cellClass}" onclick="showDetail(${i}, ${j}, ${value})">${value}</td>`;
                }

                const recall = rowSum > 0 ? ((matrix[i][i] / rowSum) * 100).toFixed(2) : 0;
                const recallClass = recall >= 90 ? 'recall-high' : (recall >= 70 ? 'recall-medium' : 'recall-low');

                html += `<td class="sum-column">${rowSum}</td>`;
                html += `<td class="recall-column ${recallClass}">${recall}%</td>`;
                html += '</tr>';
            }

            // è®¡ç®—æ€»æ•°å’Œæ€»å¬å›ç‡ã€ç²¾å‡†ç‡
            let totalCount = 0;
            let totalCorrect = 0;
            for (let i = 0; i < matrixSize; i++) {
                for (let j = 0; j < matrixSize; j++) {
                    totalCount += matrix[i][j];
                    if (i === j) totalCorrect += matrix[i][j];
                }
            }
            const totalRecall = totalCount > 0 ? ((totalCorrect / totalCount) * 100).toFixed(2) : 0;
            const totalPrecision = totalCount > 0 ? ((totalCorrect / totalCount) * 100).toFixed(2) : 0;
            const totalRecallClass = totalRecall >= 90 ? 'recall-high' : (totalRecall >= 70 ? 'recall-medium' : 'recall-low');

            // åˆè®¡è¡Œ
            html += '<tr class="sum-row">';
            html += '<td>åˆè®¡</td>';
            html += '<td></td>';
            for (let j = 0; j < matrixSize; j++) {
                let colSum = 0;
                for (let i = 0; i < matrixSize; i++) {
                    colSum += matrix[i][j];
                }
                html += `<td>${colSum}</td>`;
            }
            html += `<td>${totalCount}</td>`;
            html += `<td class="${totalRecallClass}">${totalRecall}%</td>`;
            html += '</tr>';

            // ç²¾å‡†ç‡è¡Œ
            html += '<tr class="precision-row">';
            html += '<td>ç²¾å‡†ç‡</td>';
            html += '<td></td>';
            for (let j = 0; j < matrixSize; j++) {
                let colSum = 0;
                for (let i = 0; i < matrixSize; i++) {
                    colSum += matrix[i][j];
                }
                const precision = colSum > 0 ? ((matrix[j][j] / colSum) * 100).toFixed(2) : 0;
                const precisionClass = precision >= 90 ? 'recall-high' : (precision >= 70 ? 'recall-medium' : 'recall-low');
                html += `<td class="${precisionClass}">${precision}%</td>`;
            }
            html += `<td></td>`;
            html += `<td class="${totalRecallClass}">${totalPrecision}%</td>`;
            html += '</tr>';

            html += '</tbody>';

            table.innerHTML = html;
        }

        // è®¡ç®—ç»Ÿè®¡æ•°æ®
        function calculateStatistics() {
            const { matrix, matrixSize } = matrixData;

            let total = 0;
            let correct = 0;

            for (let i = 0; i < matrixSize; i++) {
                for (let j = 0; j < matrixSize; j++) {
                    total += matrix[i][j];
                    if (i === j) correct += matrix[i][j];
                }
            }

            const accuracy = total > 0 ? ((correct / total) * 100).toFixed(2) : 0;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('wrongCount').textContent = total - correct;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
        function showDetail(expected, actual, count) {
            if (count === 0) return;

            const { cellDetails } = matrixData;
            const key = `${expected}_${actual}`;
            const details = cellDetails[key] || [];

            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('modalBody');

            let html = `
                <div class="detail-info">
                    <p><strong>é¢„æœŸå€¼:</strong> ${expected}</p>
                    <p><strong>å®é™…å€¼:</strong> ${actual}</p>
                    <p><strong>è®°å½•æ•°:</strong> ${count}</p>
                    <p><strong>çŠ¶æ€:</strong> ${expected === actual ? '<span class="badge-pass">é¢„æµ‹æ­£ç¡®</span>' : '<span class="badge-fail">é¢„æµ‹é”™è¯¯</span>'}</p>
                </div>
                <table class="detail-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>é¢„æœŸç­‰çº§</th>
                            <th>å®é™…ç­‰çº§</th>
                            <th>ç­‰çº§åç§°</th>
                            <th>åœºæ™¯</th>
                            <th>å› å­</th>
                            <th>åˆ†æ•°</th>
                            <th>æ—¶é—´æˆ³</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            details.slice(0, 20).forEach(item => {
                html += `
                    <tr>
                        <td>${item.id}</td>
                        <td>${item.expected_level}</td>
                        <td>${item.actual_level}</td>
                        <td>${item.level_name}</td>
                        <td>${item.scenario}</td>
                        <td>${item.factor}</td>
                        <td>${item.score}</td>
                        <td>${item.timestamp}</td>
                    </tr>
                `;
            });

            if (details.length > 20) {
                html += `<tr><td colspan="8" style="text-align: center; color: #999;">... è¿˜æœ‰ ${details.length - 20} æ¡è®°å½•</td></tr>`;
            }

            html += '</tbody></table>';
            modalBody.innerHTML = html;
            modal.style.display = 'block';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('detailModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // è¿”å›é…ç½®é¡µé¢
        function goBack() {
            document.getElementById('reportPage').classList.remove('active');
            document.getElementById('configPage').classList.add('active');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'success') {
            const message = document.createElement('div');
            message.className = `message message-${type}`;
            message.textContent = text;
            document.body.appendChild(message);

            setTimeout(() => {
                message.remove();
            }, 3000);
        }
    </script>
</body>
</html>
