# 混淆矩阵评估系统 - 更新日志

## v1.2.0 (2025-12-12)

### 新功能

#### 1. 总召回率和总精准率计算逻辑优化
- **总召回率 (Total Recall)**
  - 分母：所有行合计之和 - 值为0的行合计
  - 分子：对角线之和 - 0-0位置的对角线值
  - 公式：`(对角线总和 - 0-0位置值) / (行合计总和 - 0行合计) × 100%`

- **总精准率 (Total Precision)**
  - 分母：所有列合计之和 - 值为0的列合计
  - 分子：对角线之和 - 0-0位置的对角线值
  - 公式：`(对角线总和 - 0-0位置值) / (列合计总和 - 0列合计) × 100%`

- **准确率 (Accuracy)** 位置调整
  - 现在显示在混淆矩阵表格右下角（原来显示斜线的位置）

#### 2. 支持包含值为0的分类数据
- 通过设置 `minValueFilter: -1` 可以包含值为0的分类
- 0-0位置的数据会正常显示在矩阵中
- 0-0数据仅不参与总召回率和总精准率的计算，但参与准确率计算

#### 3. 自定义坐标轴标签
- 新增 `axisLabel` 属性，支持自定义"实际\预测"标签
- 从API返回的 `caseConfig.axisLabel` 字段获取
- 默认值为 "实际\预测"

#### 4. 计算逻辑说明区域
- 在混淆矩阵表格下方新增可折叠的"指标计算说明"区域
- 包含基础指标（准确率、召回率、精准率）的计算公式
- 包含汇总指标（总召回率、总精准率）的计算公式
- 当存在值为0的分类时，显示排除说明和具体排除的数据量

### 修改的文件

#### `src/utils/matrixCalculator.js`
- `calculateStatistics()` 函数新增：
  - `totalRecall` - 总召回率（排除0行和0-0）
  - `totalPrecision` - 总精准率（排除0列和0-0）
  - `hasZeroValue` - 是否包含值为0的分类
  - `zeroIndex` - 值为0的索引位置
- `getDisplayValues()` 函数修改：
  - 支持当 `minValueFilter < 0` 时从0开始生成完整矩阵

#### `src/components/ConfusionMatrix.vue`
- 新增 `axisLabel` prop 支持自定义标签
- 新增 `displayAxisLabel` 计算属性
- 新增 `totalRecallRate` 和 `totalPrecisionRate` 计算属性
- 合计行的召回率列显示总召回率
- 精准率行的合计列显示总精准率
- 精准率行的召回率列（右下角）显示准确率
- 新增计算逻辑说明区域（el-collapse）

#### `src/views/MatrixReport.vue`
- 传递 `axisLabel` prop 到 ConfusionMatrix 组件

#### `src/mock/index.js`
- 新增 RPT011 场景：包含0值场景，用于测试排除逻辑
- 新增 RPT012 场景：自定义坐标轴标签测试

#### `src/mock/mockData.js`
- `generateCaseData()` 支持 `axisLabel` 参数

### 测试场景

| 场景ID | 场景名称 | 说明 |
|--------|----------|------|
| RPT011 | 包含0值场景 | minValueFilter=-1，包含值为0的分类，测试总召回率和总精准率排除逻辑 |
| RPT012 | 自定义坐标轴标签 | 测试自定义"真实\预测"标签功能 |

### 验证结果（RPT011场景）

| 指标 | 值 | 计算公式 |
|------|-----|----------|
| 准确率 | 76.45% | 185 / 242 |
| 总召回率 | 77.66% | (185-32) / (242-45) = 153 / 197 |
| 总精准率 | 76.88% | (185-32) / (242-43) = 153 / 199 |

其中：
- 185 = 对角线总和
- 32 = 0-0位置值
- 242 = 总样本数
- 45 = 0行合计
- 43 = 0列合计
